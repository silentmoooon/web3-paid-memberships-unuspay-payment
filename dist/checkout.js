!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";!function(){jQuery((function(e){e(document).ajaxError((function(){"function"==typeof window._depayUnmountLoading&&window._depayUnmountLoading()})),e(document).ajaxComplete((function(){"function"==typeof window._depayUnmountLoading&&window._depayUnmountLoading()})),e("form.pmpro_form").on("submit",(async()=>{if(e("form.pmpro_form").serialize().match("pmpro_checkout_gateway=pmp_unuspay_gateway")){let{unmount:e}=await DePayWidgets.Loading({text:"Loading payment data..."});setTimeout(e,1e4)}}))}));const e=async()=>{if(window.location.hash.startsWith("#pmp-unuspay-checkout-")){const e=window.location.hash.match(/pmp-unuspay-checkout-(.*?)@/)[1],t=JSON.parse(await wp.apiRequest({path:`/unuspay/pmp/checkouts/${e}`,method:"POST"}));if(t.redirect)return void(window.location=t.redirect);const o=[];t.tokens.forEach((e=>{o.push({blockchain:e.blockchain,amount:e.amount,token:e.tokenAddress,receiver:e.receiveAddress,fee:{amount:e.feeRate+"%",receiver:e.feeAddress}})}));let n={accept:o,closed:()=>{window.location.hash="",window.location.reload(!0)},track:{method:t=>new Promise(((o,n)=>{try{wp.apiRequest({path:`/unuspay/pmp/checkouts/${e}/track`,method:"POST",data:t}).done((()=>o({status:200}))).fail(((e,t)=>n(t)))}catch(e){n()}})),poll:{method:()=>new Promise(((t,o)=>{wp.apiRequest({path:"/unuspay/pmp/release",method:"POST",data:{checkout_id:e}}).done((e=>{t(e)})).fail(t)}))}}};DePayWidgets.Payment(n)}};document.addEventListener("DOMContentLoaded",e),window.addEventListener("hashchange",e)}()}));
